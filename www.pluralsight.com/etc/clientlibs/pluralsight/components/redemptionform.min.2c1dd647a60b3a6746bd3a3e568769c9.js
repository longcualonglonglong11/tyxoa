function initRedemptionForms($components){var that=this;var $forms=$components;this.$offerCodeInput=$forms.find("input[name='offercode']");this.$optInBox=$forms.find("input[name='optInBox']");this.$submitButton=$forms.find('a.button');this.$countryDropdown=$forms.find('select[name=country]');if(this.$optInBox.length){this.$optInBox.each(function(){var optIn=jQuery(this);var parentForm=jQuery(optIn.parents('form')[0]);parentForm.find('a.button').attr("disabled","disabled");optIn.click(function(){var submitButton=parentForm.find('a.button');if(optIn.prop("checked")){submitButton.removeAttr("disabled");}else{submitButton.attr("disabled","disabled");}});});this.$optInBox.click(function(){var $thisOptInBox=jQuery(this);var $thisSubmitButton=jQuery(this).parent('form').find('a.button');if($thisOptInBox.prop("checked")){$thisSubmitButton.removeAttr("disabled");}else{$thisSubmitButton.attr("disabled","disabled");}});}
if(this.$countryDropdown.length){this.$countryDropdown.each(function(){var countryDropdown=jQuery(this);var parentForm=jQuery(countryDropdown.parents('form')[0]);countryDropdown.change(function(){var countryCode=countryDropdown.find("option:selected").val();var optInCountriesCodes=["AF","AX","AL","AS","AD","AM","AU","AT","AZ","BH","BD","BY","BE","BT","BA","BV","IO","BN","BG","KH","CA","CV","CN","CX","CC","CD","CK","CI","HR","CY","DK","EE","FO","FJ","FI","FR","PF","TF","GE","DE","GI","GR","GU","GG","HM","HK","HU","IS","ID","IQ","IE","IM","IL","IT","JP","JE","JO","KZ","KR","KW","LA","LV","LB","LY","LI","LT","LU","MO","MK","MY","MV","MT","MH","YT","FM","MD","MC","MN","ME","MM","NR","NP","NL","NZ","NU","NF","MP","NO","OM","PK","PW","PS","PG","PH","PN","PL","PT","RE","RO","RU","WS","SM","SA","RS","SG","SK","SI","SB","GS","ES","SJ","SE","CH","TW","TZ","TH","TL","TK","TO","TR","TM","TV","UA","AE","GB","UZ","VU","VN","VG","WF","EH","YE","ZW"];if(jQuery.inArray(countryCode,optInCountriesCodes)!==-1){parentForm.find('.gdpr-opt-in-box').show();}else{parentForm.find('.gdpr-opt-in-box').hide();}});});}
var companyFieldName=jQuery('input[name="company"]').attr('name'),dbCompanyFieldName=jQuery('input[name="VIFF_DB_Company__c"]');if(typeof companyFieldName=="undefined"){companyFieldName=dbCompanyFieldName;}
if(typeof Fill!="undefined"){if(window.ActiveXObject){window.ActiveXObject=null;}
var dpa=new Fill.LeadFormApp({visitorIntelligenceApiKey:"api7831",defaultCompanyCountry:"US",leadFormName:"redemption-form",contactEmailSearchFieldName:"email",companyNameSearchFieldName:companyFieldName,useLIDropdowns:true,visitorIDEnabled:false,initialFocusFieldName:"",dunsFieldName:"VIFF_DB_DUNS__c",companyNameFieldName:companyFieldName,firstNameFieldName:"VIFF_DB_FirstName__c",lastNameFieldName:"VIFF_DB_LastName__c",vanityTitleFieldName:"VIFF_DB_Job_Title__c",telephoneNumberFieldName:"VIFF_DB_Personal_Phone__c"});dpa.attach();}
$forms.find('input[name=phone], select[name=country]').on("change focusout",function(item){var $thisForm=jQuery(item.target).closest("#redemption-form");var $thisPhone=$thisForm.find("input[name=phone]");var $thisCountry=$thisForm.find("select[name=country]");if($thisPhone.val()!=""&&$thisPhone.val()!=null&&$thisCountry.val()=="US"){$thisForm.find(".sms-opt-in").removeClass("hide");}else{$thisForm.find(".sms-opt-in").addClass("hide");$thisForm.find("input[name=smsOptInBox]").prop("checked",false);}});function getQueryVariable(variable){var query=window.location.search.substring(1);var vars=query.split('&');for(var i=0;i<vars.length;i++){var pair=vars[i].split('=');if(decodeURIComponent(pair[0])==variable){return decodeURIComponent(pair[1]);}}}
var showOfferCodeInput=getQueryVariable("loadOfferCodes");if(showOfferCodeInput==="true"){jQuery(".batchoffercodes").show();}
var loadedOfferCodes=JSON.parse(localStorage.getItem('redemptionOfferCodes'))||[];function refreshOfferQuantity(){jQuery("#batchoffercodes_quantity").text(loadedOfferCodes.length);jQuery("#batchoffercodes_quantity").css("color","green");}
jQuery("#batchoffercodes_button").click(function(){var $offercodeInput=jQuery(this).parent();var offerCodesToLoad=$offercodeInput.find("#batchoffercodes_textarea").val();if(offerCodesToLoad!==""){var dirty=false;var offerCodes=offerCodesToLoad.split(/\r?\n/g)||[];if(offerCodes.length){for(var i=0;i<offerCodes.length;i++){if(jQuery.inArray(offerCodes[i],loadedOfferCodes)===-1){var offerCodeValue=offerCodes[i].trim();if(offerCodeValue.length){loadedOfferCodes.push(offerCodeValue);}
dirty=true;}}}
if(loadedOfferCodes.length&&dirty){localStorage.setItem('redemptionOfferCodes',JSON.stringify(loadedOfferCodes));}
refreshOfferQuantity();}});var offerCode=getQueryVariable("offerCode");var localStorageOfferCodeUsed=false;if(offerCode){this.$offerCodeInput.val(offerCode);$forms.find('#offercodesection').hide();}else if(loadedOfferCodes.length){this.$offerCodeInput.val(loadedOfferCodes[0]);$forms.find('#offercodesection').hide();localStorageOfferCodeUsed=true;refreshOfferQuantity();}
if(jQuery('meta[name=rfWID]').length){$forms.find('input[name=wid]').val(jQuery('meta[name=rfWID]').attr('content'));}
if(jQuery('meta[name=rfIntroParagraph]').length){if(!$forms.find('.form_intro_paragraph').length){$forms.prepend('<p class="form_intro_paragraph"></p>');}
$forms.find('.form_intro_paragraph').text(jQuery('meta[name=rfIntroParagraph]').attr('content'));}
if(jQuery('meta[name=rfTitleText]').length){if(!$forms.find('.form_intro_title').length){$forms.prepend('<h3 class="form_intro_title"></h3>');}
$forms.find('.form_intro_title').text(jQuery('meta[name=rfTitleText]').attr('content'));}
if(jQuery('meta[name=rfButtonText]').length){this.$submitButton.text(jQuery('meta[name=rfButtonText]').attr('content'));}
if(jQuery('meta[name=rfLegalParagraph]').length){if(!$forms.find('.form-terms.extra-legal').length){jQuery('<p class="form-terms extra-legal"></p>').insertAfter($forms.find('.requiredfield'));}
$forms.find('.form-terms.extra-legal').html(jQuery('meta[name=rfLegalParagraph]').attr('content'));}
var $darkStyle=jQuery('meta[name=rfDarkStyle]');if($darkStyle.length&&$darkStyle.attr('content')==="true"){$forms.addClass('dark-style');}
if(jQuery('meta[name=rfMktoProgramName]').length){$forms.find("input[name='ProgramName']").val(jQuery('meta[name=rfMktoProgramName]').attr('content'));}
if(jQuery('meta[name=rfMktoLeadSource]').length){$forms.find("input[name='LeadSource']").val(jQuery('meta[name=rfMktoLeadSource]').attr('content'));}
if(jQuery('meta[name=rfTrackingGroup]').length){$forms.find("input[name='trackingGroup']").val(jQuery('meta[name=rfTrackingGroup]').attr('content'));}
if(jQuery('meta[name=rfOfferCode]').length){this.$offerCodeInput.val(jQuery('meta[name=rfOfferCode]').attr('content'));$forms.find('#offercodesection').hide();}
if(jQuery('meta[name=rfRedirect]').length){$forms.find("input[name='redirectTo']").val(jQuery('meta[name=rfRedirect]').attr('content'));}
if(jQuery('meta[name=rfCompanyRequired]').length){if($forms.find('.redemptionlabel.usercompany').text().slice(-1)!="*"){$forms.find('.redemptionlabel.usercompany').append("*");}
$forms.find('input[name=company]').attr("data-required","true");}
if(jQuery('meta[name=rfTitleRequired]').length){if($forms.find('.redemptionlabel.usertitle').text().slice(-1)!="*"){$forms.find('.redemptionlabel.usertitle').append("*");}
$forms.find('input[name=title]').attr("data-required","true");}
if(jQuery('meta[name=rfPhoneRequired]').length){if($forms.find('.redemptionlabel.userphone').text().slice(-1)!="*"){$forms.find('.redemptionlabel.userphone').append("*");}
$forms.find('input[name=phone]').attr("data-required","true");}
var $companyHide=jQuery('meta[name=rfCompanyHide]');if($companyHide.length&&$companyHide.attr('content')==="true"){$forms.find('#companySection').hide();}
var $titleHide=jQuery('meta[name=rfTitleHide]');if($titleHide.length&&$titleHide.attr('content')==="true"){$forms.find('#titleSection').hide();}
var $phoneHide=jQuery('meta[name=rfPhoneHide]');if($phoneHide.length&&$phoneHide.attr('content')==="true"){$forms.find('#phoneSection').hide();}
setTimeout(function(){if(jQuery.cookie("partnerid")){$forms.find("input[name='externalReferenceId']").val(jQuery.cookie("partnerid"));}},1000);function removeFirstOfferCodeInLS(){var loadedOfferCodes=JSON.parse(localStorage.getItem('redemptionOfferCodes'))||[];loadedOfferCodes.splice(0,1);localStorage.setItem('redemptionOfferCodes',JSON.stringify(loadedOfferCodes));}
function clearErrorLabels($form){that.$offerCodeInput.focus(function(e){$form.find("#offer").text("");});$form.find("input[name='email']").focus(function(e){$form.find("#email").text("");});$form.find("input[name='firstname']").focus(function(e){$form.find("#firstname").text("");});$form.find("input[name='lastname']").focus(function(e){$form.find("#lastname").text("");});$form.find("input[name='company']").focus(function(e){$form.find("#company").text("");});$form.find("select[name='title']").focus(function(e){$form.find("#title").text("");});$form.find("input[name='phone']").focus(function(e){$form.find("#phone").text("");});$form.find("select[name='country']").focus(function(e){$form.find("#country").text("");});$form.find("#generic-error").text("");}
clearErrorLabels($forms);function parseError($form,error){var regexCamCase=/([a-z])([A-Z])/g;if((error==="Invalid or missing Offer Code"||error==="Invalid offer code")&&that.$offerCodeInput.attr('type')!=='hidden'){$form.find("#offer").text(error).addClass("red");}else if(error==="The EmailAddress field is required."||error==="The Email field is not a valid e-mail address."){$form.find("#email").text(error.replace(regexCamCase,'$1 $2')).addClass("red");}
else if(error==="The FirstName field is required."){$form.find("#firstname").text(error.replace(regexCamCase,'$1 $2')).addClass("red");}
else if(error==="The LastName field is required."){$form.find("#lastname").text(error.replace(regexCamCase,'$1 $2')).addClass("red");}
else if(error==="The Company field is required."){$form.find("#company").text(error).addClass("red");}
else if(error==="The Country field is required."){$form.find("#country").text(error).addClass("red");}
else if(error==="The Title field is required."){$form.find("#title").text(error).addClass("red");}
else if(error==="The Phone field is required."){$form.find("#phone").text(error).addClass("red");}
else{$form.find("#generic-error").text(error).addClass("red");}}
function validateInput($form){var isGood=true;if(that.$offerCodeInput.val()===null||that.$offerCodeInput.val()===""){parseError($form,"Invalid or missing Offer Code");isGood=false;}
var emailRegex=/\S+@\S+\.\S+/;if($form.find("input[name='email']").val()===null||$form.find("input[name='email']").val()===""){parseError($form,"The EmailAddress field is required.");isGood=false;}else if(!emailRegex.test($form.find("input[name='email']").val())){parseError($form,"The Email field is not a valid e-mail address.");isGood=false;}else{nbValid=$form.find(".nbInvalid").length==0;if(!nbValid){parseError($form,"The Email field is not a valid e-mail address.");isGood=false;}}
if($form.find("input[name='firstname']").val()===null||$form.find("input[name='firstname']").val()===""){parseError($form,"The FirstName field is required.");isGood=false;}
if($form.find("input[name='lastname']").val()===null||$form.find("input[name='lastname']").val()===""){parseError($form,"The LastName field is required.");isGood=false;}
var companyInput=$form.find("input[name='company']");if(companyInput.data('required')===true&&(companyInput.val()===null||companyInput.val()==="")){parseError($form,"The Company field is required.");isGood=false;}
var titleSelect=$form.find("select[name='title']");if(titleSelect.data('required')===true&&(titleSelect.val()===null||titleSelect.val()==="")){parseError($form,"The Title field is required.");isGood=false;}
var phoneInput=$form.find("input[name='phone']");if(phoneInput.data('required')===true&&(phoneInput.val()===null||phoneInput.val()==="")){parseError($form,"The Phone field is required.");isGood=false;}
var countrySelect=$form.find("select[name='country']");if(countrySelect.data('required')===true&&(countrySelect.val()===null||countrySelect.val()==="")){parseError($form,"The Country field is required.");isGood=false;}
return isGood;}
function prepVal(value){return encodeURIComponent(value).replace(new RegExp('%20','g'),'+');}
this.$submitButton.click(function(e){var $form=jQuery(this).parent();var $submitBtn=jQuery(this);if($submitBtn.attr("disabled")!=="disabled"){jQuery($submitBtn).attr("disabled","disabled");clearErrorLabels($form);if(validateInput($form)){var oidValue='oid='+jQuery('meta#view-oid').data('view-oid');var widValue='wid='+jQuery('input[name=wid]').val();var data={};data.offerCode=$form.find("input[name='offercode']").val();window.offerCode=data.offerCode;data.emailAddress=$form.find("input[name='email']").val();data.firstName=$form.find("input[name='firstname']").val();data.lastName=$form.find("input[name='lastname']").val();data.company=$form.find("input[name='company']").val();data.country=$form.find("select[name='country'] option:selected").text();data.title=$form.find("select[name='title'] option:selected").text();data.phone=$form.find("input[name='phone']").val();data.ipAddress=window.visitorIP;data.programName=$form.find("input[name='ProgramName']").val();data.optInBoxGDPR=$form.find("input[name='optInBoxGDPR']")[0].checked;if($form.find("input[name='optInBox']").length){data.acceptedTermsAndPrivacy=$form.find("input[name='optInBox']")[0].checked;}
if($form.find("input[name='thirdPartySharing']").length){var thirdPartySharing="";if($form.find("input[name='thirdPartySharing']")[0].checked){thirdPartySharing=$form.find("input[name='thirdPartySharing']").attr("data-checkedval")}else{thirdPartySharing=$form.find("input[name='thirdPartySharing']").attr("data-notcheckedval")}
if(thirdPartySharing){data.thirdPartySharing=thirdPartySharing;}}
if($form.find("input[name='externalReferenceId']").length){data.externalReferenceId=$form.find("input[name='externalReferenceId']").val();}
if($form.find("input[name='redirectTo']").length){data.redirectTo=$form.find("input[name='redirectTo']").val();}
var dataStr="";if(data.emailAddress.length){dataStr+="email="+prepVal(data.emailAddress);}
if(data.firstName.length){dataStr+="&FirstName="+prepVal(data.firstName);}
if(data.lastName.length){dataStr+="&LastName="+prepVal(data.lastName);}
if(data.phone.length){dataStr+="&Phone="+prepVal(data.phone);}
if(data.company.length){dataStr+="&Company="+prepVal(data.company);}
if(data.country.length){dataStr+="&Country="+prepVal(data.country);}
if(data.title.length){dataStr+="&Title="+prepVal(data.title);}
if(typeof jQuery.cookie('_mkto_trk')!=='undefined'&&jQuery.cookie('_mkto_trk').length){var cookieVal=jQuery.cookie('_mkto_trk');data.mktoTrk=prepVal(cookieVal);if(/[0-9A-Z]\w{2}-[0-9A-Z]\w{2}-[0-9A-Z]\w{2}/g.test(cookieVal)){data.munchkinId=/[0-9A-Z]\w{2}-[0-9A-Z]\w{2}-[0-9A-Z]\w{2}/g.exec(cookieVal)[0];}}
var $leadsourceInput=$form.find("input[name=LeadSource]");if($leadsourceInput.length&&$leadsourceInput.val().length){dataStr+="&LeadSource="+prepVal($leadsourceInput.val());}
if($form.find("input[name='optInBoxGDPR']").length){dataStr+="&Single_Opt_In__c="+$form.find("input[name='optInBoxGDPR']")[0].checked;}
if(data.acceptedTermsAndPrivacy){dataStr+="&Opt_In_Source__c="+prepVal("Offer Redemption - "+data.programName);}
if($form.find("input[name='smsOptInBox']").length){dataStr+="&SMS_Opt_In__c="+$form.find("input[name='smsOptInBox']")[0].checked;}
dataStr+="&Lead_Subscription_Type__c=individual";dataStr+="&UserAccount__c=[USER_HANDLE]";var dnbFieldArray=["VIFF_DB_Company__c","VIFF_DB_FirstName__c","VIFF_DB_LastName__c","VIFF_DB_DUNS__c","VIFF_DB_Job_Title__c","VIFF_DB_Personal_Phone__c"];for(var i=0;i<dnbFieldArray.length;i++){dataStr+="&"+dnbFieldArray[i]+"="+prepVal($form.find("input[name='"+dnbFieldArray[i]+"']").val());}
dataStr+="&DunsNumber__c="+prepVal($form.find("input[name='VIFF_DB_DUNS__c']").val());dataStr+="&GCLID__c="+prepVal($form.find("input[name='GCLID__c']").val());data.marketoData_data=dataStr;var hiddenForm='';for(var key in data){var value=data[key];hiddenForm+=`<input type="hidden" name="${key}" value="${value}">`;}
var hiddenFormElement=jQuery(`<form id="hidden-form" hidden action="/bin/redemption" method="POST">${hiddenForm}</form>`)
hiddenFormElement.appendTo(jQuery(document.body));dtmEventTrigger("ps.redemptionFormSubmit");hiddenFormElement.trigger('submit');hiddenFormElement.remove();}else{$submitBtn.removeAttr("disabled");}}});window._NBSettings={apiKey:'public_fb53638aa6dd8cdc3936b8137dec535b',displayPoweredBy:false};loadRemoteScript('cdn.neverbounce.com/widget/dist/NeverBounce.js','text/javascript',1,'neverbounce',function(){});document.querySelector('body').addEventListener('nb:registered',function(event){let field=document.querySelector('[data-nb-id="'+event.detail.id+'"]');field.addEventListener('nb:result',function(e){if(e.detail.result.is(_nb.settings.getAcceptedStatusCodes())){jQuery(e.target).css("border","");jQuery(e.target).removeClass("nbInvalid");}else{jQuery(e.target).css("border","2px solid red");jQuery(e.target).addClass("nbInvalid");}});});}
jQuery(document).ready(function(){function getUrlParameter(name){name=name.replace(/[\[]/,'\\[').replace(/[\]]/,'\\]');var regex=new RegExp('[\\?&]'+name+'=([^&#]*)');var results=regex.exec(location.search);return results===null?'':decodeURIComponent(results[1].replace(/\+/g,' '));};if(document.URL.indexOf("status=success")>-1&&document.URL.indexOf("statusUrl")>-1){var statusUrl=getUrlParameter('statusUrl');var offerCode=getUrlParameter('offerCode');if(statusUrl.length>0){var $form=jQuery("#redemption-form");if(offerCode.length>0){offerCode=atob(offerCode);}
var trackingGroup=$form.find("input[name='trackingGroup']").val();var decodedUrl=atob(statusUrl);setTimeout(function(){dtmEventTrigger("ps.redemptionFormSuccess",{'trackingGroup':trackingGroup,'offerCode':offerCode});},1000);setTimeout(function(){window.location.replace(decodedUrl);},1500);}}else{var redForms=jQuery(".redemption-form form");if(redForms.length){initRedemptionForms(redForms);}
if(document.URL.indexOf("status=failure")>-1){if(document.URL.indexOf("errors=")>-1){var errors=getUrlParameter("errors");setTimeout(function(){dtmEventTrigger("ps.redemptionFormFailure",{'error':atob(errors)});},1000);jQuery("#generic-error").html("<h6 style='color:red;'>"+atob(errors)+"</h6>");}else{setTimeout(function(){dtmEventTrigger("ps.redemptionFormFailure",{'error':"Form Submit Error"});},1000);jQuery("#generic-error").html("<h6 style='color:red;'>There was an error with form submit.</h6>");}}}});